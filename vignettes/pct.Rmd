---
title: "An Introduction to the pct package 1/2"
subtitle: "Obtaining data from the Propensity to Cycle Tool (PCT)"
author: 
- "Robin Lovelace and Layik Hama"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introducing the pct package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: refs.bib
csl: nature.csl
---

```{r, eval=FALSE, echo=FALSE}
# Aim: generate references.bib - run only if references change
refs = RefManageR::ReadZotero(group = "418217", .params = list(collection = "8Y9DU4DR", limit = 100))
RefManageR::WriteBib(refs, "vignettes/references.bib")
citr::tidy_bib_file(
  rmd_file = "vignettes/pct.Rmd",
  messy_bibliography = "vignettes/references.bib",
  file = "vignettes/refs.bib")
file.remove("vignettes/references.bib")
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

The goal of the `pct` package is to increase the accessibility and reproducibility of the outputs from the Propensity to Cycle Tool (PCT), a research project and web application hosted at [www.pct.bike](https://www.pct.bike/).
The tool is one of just ~300 [central government websites](https://www.gov.uk/performance/central-government-websites) exempt from the requirement to transition to the .gov.uk domain name, and is a recommended source of evidence in the preparation of Local Walking and Cycling plans (LCWIPs), as outlined in [technical guidance](https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/607016/cycling-walking-infrastructure-technical-guidance.pdf) [@department_for_transport_local_2017], supporting the Cycling and Walking Infrastructure Strategy ([CWIS](https://www.gov.uk/government/publications/cycling-and-walking-investment-strategy)), an amendment of the [Infrastructure Act](https://www.legislation.gov.uk/ukpga/2015/7/contents/enacted) 2015.
For an overview of the data provided by the PCT, clicking on the previous link and trying it out is a great place to start.
An academic [paper](https://www.jtlu.org/index.php/jtlu/article/view/862) on the PCT provides detail on the motivations and methods underlying the project [@lovelace_propensity_2017].

Since work on the package began in 2015, for example during the ODI Leeds Hack my Route [hackathon](https://datamillnorth.org/community/blog/hack-my-route-live-blog/) (see [an early prototype of the tool here](https://twitter.com/robinlovelace/status/611979463803432960)), the features and demand for the PCT have evolved substantially.
In early 2019, for example, the [School travel layer](https://blog.pct.bike/2019/03/18/propensity-to-cycle-to-school-layer-deployed/) was added to the main PCT site to provide evidence nationwide on the potential benefits of scenarios of cycling uptake, and where safe routes to school should be prioritised [@goodman_scenarios_2019].
In fact, a major aim of the PCT was to enable people to extend the tool [@lovelace_propensity_2017]:

> We envision stakeholders in local government modifying scenarios for their own purposes, and that academics in relevant fields may add new features and develop new use cases
of the PCT.

Motivated by this vision of adaptable transport planning tools, this introductory vignette demonstrates how the package works with an example from the [Isle of Wight](https://en.wikipedia.org/wiki/Isle_of_Wight), an island just off the southern coast of Britain, with a population of ~140,000 people.
Before demonstrating some of the package's key functions, it's worth providing a little context.

## Why this package?

The Propensity to Cycle Tool was commissioned by the UK's Department for Transport to help planners and others prioritise investment and policies to get people cycling, as outlined in the Government report [National propensity to cycle: full report with annexes](https://www.gov.uk/government/publications/national-propensity-to-cycle-first-phase-development-study) [@department_for_transport_national_2016].
However, the academic team leading the project had a wider sub-aim: of making transport evidence more accessible, encouraging evidence-based transport policies, and encouraging a more democratic transport planning process, and that means open transport data and open source transport modelling tools [@lovelace_propensity_2017].


The code base underlying the PCT is publicly available (see [github.com/npct](https://github.com/npct/)).
However, the code hosted there is not easy to run or reproduce, which is where this package comes in: it provides quick access to the data underlying the PCT and enables some of the key results to be reproduced quickly.
It was developed primarily for educational purposes (including for upcoming PCT training courses) but it may be useful for people to build on the the methods, for example to create a scenario of cycling uptake in their town/city/region.

In summary, if you want to know how PCT works, be able to reproduce some of its results, and build scenarios of cycling uptake to inform transport policies enabling cycling in cities worldwide, this package is for you!

## Installation

You can install the development version of the package as follows:

```{r, eval=FALSE}
remotes::install_github("ITSLeeds/pct")
```

<!-- You can install the released version of pct from [CRAN](https://CRAN.R-project.org) with: -->

<!-- ``` r -->
<!-- install.packages("pct") -->
<!-- ``` -->

Load the package as follows:

```{r}
library(pct)
```

# Get PCT data

From feedback, we hear that the use of the data is critical in decision making. Therefore, one area where the package could be useful is making the data "easily" available to be processed.

To download the data within www.pct.bike, we have added a suite of functions:

* `get_pct()`
* `get_pct_rnet()` 
* `get_pct_zones()` 
* `get_pct_lines()` 
* `get_pct_centroids()`
* `get_pct_routes_fast()` 
* `get_pct_routes_quiet()` 

There are other `get_()` functions that get official data underlying the PCT, as we will see in a later section.
For now, let's see how the functions work.
To get the centroids in Isle of Wight at the lower-resolution (smaller files) MSOA level (LSOA level data is returned by default or by replacing `msoa` with `lsoa` in the code below) you would run:

```{r}
wight_centroids = get_pct_centroids(region = "isle-of-wight", geography = "msoa")
wight_zones = get_pct_zones(region = "isle-of-wight", geography = "msoa")
```

Let's verify that the data gave us what we would expect to see:

```{r centroids, fig.show='hold'}
plot(wight_centroids[, "bicycle"])
plot(wight_zones[, "bicycle"])
```

The results are indeed as we would expect, with the centroid data showing points and the zone data showing zones.
The zones with higher cycling levels are in the more densely populated south of the island, as we would expect.
Likewise, the following command downloads the desire lines for the Isle of Wight:

```{r get_pct_lines}
wight_lines_pct = get_pct_lines(region = "isle-of-wight", geography = "msoa")
```

The rest of the `get_pct_` functions are similar to the above two examples and download data from www.pct.bike.

However, the base of these functions is `get_pct()`, which takes the following arguments:

* `base_url = "https://github.com/npct/pct-outputs-regional-R/raw/master"`: just in case if you wanted to download the data from a similar server
* `purpose = "commute"`: soon there will be "schools" and maybe other modes, but currently commute is the only option. 
* `geography = "msoa"`: MSOA or LSOA
* `region = NULL`: regions within `pct::pct_regions`
* `layer = NULL`: one of `z` (zones), `c` (centroids), `l` (desire lines), `rf` (routes fast), `rq` (routes quiet) or `rnet`.
* even `extension = ".Rds"` as PCT data is available in various formats. For the purpose of this package we have made the default option of "Rds".

# Next steps

We have now dowloaded some data using `pct` that we may want to compare to that from PCT web App. The  [following vignette](https://itsleeds.github.io/pct/articles/pct_reproducing_website.html) describes, precisely, how to do so.

# References
